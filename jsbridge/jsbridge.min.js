!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).jsbridge={})}(this,(function(e){"use strict";const t={};function n(e,t,n){return"Expected "+n+" to be typeof "+t+", actual typeof was "+e}function r(e,t){e instanceof HTMLElement!=!1?function(e){if(e.parentNode&&e.parentNode.removeChild(e),e instanceof HTMLVideoElement){if(e.hlsPlayer&&(e.hlsPlayer.destroy(),delete e.hlsPlayer),e.flvPlayer){try{e.flvPlayer.unload(),e.flvPlayer.detachMediaElement()}catch(e){console.error(e)}e.flvPlayer.destroy(),delete e.flvPlayer}try{e.pause(),e.loop=!1,e.removeAttribute("src"),e.load()}catch(e){console.error(e)}}else e instanceof HTMLImageElement?e.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=":e instanceof HTMLCanvasElement&&(e.apngPlayer&&(e.apngPlayer.stop(),delete e.apngPlayer),e.gifPlayer&&(e.gifPlayer.stop(),delete e.gifPlayer),e.width=e.height=0)}(e):console.warn("The element must be instanceof HTMLElement.")}function s(){return!0}function o(e,t){if(!function(e){return void 0!==e.isDestroyed&&("function"==typeof e.isDestroyed?e.isDestroyed():e.isDestroyed)}(e)&&!e.isDestroying){(t=Object.assign({deleteProperty:!0,ignoreProperties:[],overwriteFunction:!0,releaseArray:!0,destroyHTMLElement:!0},t)).ignoreProperties.push("isDestroying","isDestroyed","destroy","undeletable"),e.isDestroying=!0;for(const s in e)if(!t.ignoreProperties||-1===t.ignoreProperties.indexOf(s)){try{const i=e[s];if(i){if(i.isCached||i.isProtected)continue;if("function"==typeof i&&!0===t.overwriteFunction?e[s]=n:Array.isArray(i)&&!0===t.releaseArray?i.length=0:i instanceof HTMLElement&&!0===t.destroyHTMLElement?r(e[s]):"object"==typeof i&&!0===t.deep&&("function"==typeof i.destroy?i.destroy():o(i,deep)),i.undeletable)continue}}catch(e){console.warn(e)}!0===t.deleteProperty&&delete e[s]}return e.isDestroyed=s,delete e.isDestroying,e}function n(){console.warn("The object isDestroyed, call function is invalid.",e)}console.warn("The object isDestroyed or isDestroying, repeated call destroyObject function are not required.",e)}t.typeOf={},t.defined=function(e,t){if(null==t)throw new Error(function(e){return e+" is required, actual value was undefined."}(e))},t.valid=function(e,t){if(null==(n=t)||"number"==typeof n&&isNaN(n))throw new Error(function(e){return e+" is required, actual value was invalid."}(e));var n},t.typeOf.func=function(e,t){if("function"!=typeof t)throw new Error(n(typeof t,"function",e))},t.typeOf.string=function(e,t){if("string"!=typeof t)throw new Error(n(typeof t,"string",e))},t.typeOf.number=function(e,t){if("number"!=typeof t)throw new Error(n(typeof t,"number",e))},t.typeOf.number.lessThan=function(e,n,r){if(t.typeOf.number(e,n),n>=r)throw new Error("Expected "+e+" to be less than "+r+", actual value was "+n)},t.typeOf.number.lessThanOrEquals=function(e,n,r){if(t.typeOf.number(e,n),n>r)throw new Error("Expected "+e+" to be less than or equal to "+r+", actual value was "+n)},t.typeOf.number.greaterThan=function(e,n,r){if(t.typeOf.number(e,n),n<=r)throw new Error("Expected "+e+" to be greater than "+r+", actual value was "+n)},t.typeOf.number.greaterThanOrEquals=function(e,n,r){if(t.typeOf.number(e,n),n<r)throw new Error("Expected "+e+" to be greater than or equal to"+r+", actual value was "+n)},t.typeOf.number.equals=function(e,n,r,s){if(t.typeOf.number(e,r),t.typeOf.number(n,s),r!==s)throw new Error(e+" must be equal to "+n+", the actual values are "+r+" and "+s)},t.typeOf.object=function(e,t){if("object"!=typeof t)throw new Error(n(typeof t,"object",e))},t.typeOf.bool=function(e,t){if("boolean"!=typeof t)throw new Error(n(typeof t,"boolean",e))},t.typeOf.array=function(e,t){if(!1===Array.isArray(t))throw new Error(n(typeof t,"array",e))},t.typeOf.integer=function(e,t){if(!1===Number.isSafeInteger(t))throw new Error(n(typeof t,"integer",e))},t.typeOf.integer.lessThan=function(e,n,r){if(t.typeOf.integer(e,n),n>=r)throw new Error("Expected "+e+" to be less than "+r+", actual value was "+n)},t.typeOf.integer.lessThanOrEquals=function(e,n,r){if(t.typeOf.integer(e,n),n>r)throw new Error("Expected "+e+" to be less than or equal to "+r+", actual value was "+n)},t.typeOf.integer.greaterThan=function(e,n,r){if(t.typeOf.integer(e,n),n<=r)throw new Error("Expected "+e+" to be greater than "+r+", actual value was "+n)},t.typeOf.integer.greaterThanOrEquals=function(e,n,r){if(t.typeOf.integer(e,n),n<r)throw new Error("Expected "+e+" to be greater than or equal to"+r+", actual value was "+n)},t.typeOf.integer.equals=function(e,n,r,s){if(t.typeOf.integer(e,r),t.typeOf.integer(n,s),r!==s)throw new Error(e+" must be equal to "+n+", the actual values are "+r+" and "+s)},t.instanceOf=function(e,t,r){if(t instanceof r==!1)throw new Error(n(!1,r.name,e))},t.equals=function(e,n,r){if(t.isValid(n),t.isValid(r),n!==r)throw new Error("Expected "+e+" to be equal "+r+", actual value was "+n)};class i{isDestroyed(){return!1}onDestroy(...e){}destroy(...e){return this.isDestroyed()?console.warn("This object was destroyed.",this):this.isDestroying?console.warn("This object is destroying.",this):(this.onDestroy(...e),o(this)),this}}function a(e){return Array.isArray(e)}function c(e){return"string"==typeof e}class u extends i{constructor(){super(),this._listenersMap=new Map}get numberOfListeners(){return this._listenersMap.size}get listeners(){const e=[],t=this._listenersMap.values();for(const n of t)e.push(n.callback);return e}hasEventListener(e){return this._listenersMap.has(e)}addEventListener(e,n={}){t.typeOf.func("callback",e);let r=this._listenersMap.get(e);return r?r.options=n:(r={callback:e,options:n,removeFunc:()=>{this.removeEventListener(e)}},this._listenersMap.set(e,r)),r.removeFunc}removeEventListener(e){return t.typeOf.func("callback",e),this._listenersMap.delete(e)}on(e,t){return this.addEventListener(e,t)}off(e){return this.removeEventListener(e)}once(e,t){return this.addEventListener(e,{once:!0,scope:t})}clear(){return this._listenersMap.clear(),this}raiseEvent(...e){const t=this._listenersMap.values();for(const e of t){const t=e.options,n=e.callback;n.apply(t.scope,arguments),t.once&&this._listenersMap.delete(n)}return this}onDestroy(){this.clear()}}function f(e,t,n,r){let s=e.get(t);s||(s=new u,e.set(t,s)),s.addEventListener(n,r)}function l(e,t,n){const r=e.get(t);r&&(n?r.removeEventListener(n):(e.delete(t),r.destroy()))}class d extends i{constructor(){super(),this._events=new Map}addEventListener(e,n,r){return t.valid("type",e),t.typeOf.func("callback",n),c(e)&&e.match(/\s+/)&&(e=e.split(/\s+/)),a(e)?e.forEach((e=>{f(this._events,e,n,r)})):f(this._events,e,n,r),this}removeEventListener(e,n){return t.valid("type",e),c(e)&&e.match(/\s+/)&&(e=e.split(/\s+/)),a(e)?e.forEach((e=>{l(this._events,e,n)})):l(this._events,e,n),this}removeAllEventListeners(){return this._events.forEach((function(e){e.destroy()})),this._events.clear(),this}get numberOfEvents(){return this._events.size}numberOfListeners(e){t.valid("type",e);const n=this._events.get(e);return n?n.numberOfListeners:0}hasEventListener(e){t.valid("type",e);const n=this._events.get(e);return n&&n.numberOfListeners>0}getEventListeners(e){t.valid("type",e);const n=this._events.get(e);return n&&n.listeners}dispatch(e,...n){t.valid("type",e);const r=this._events.get(e);return r&&r.raiseEvent(...n),this}dispatchEvent(e,n){t.typeOf.object("event",e),t.valid("event.type",e.type),e.owner||(e.owner=n||this);const r=this._events.get(e.type);return r&&r.raiseEvent(e),this}onDestroy(){this.removeAllEventListeners()}}for(var p,h=[],y=0;y<256;++y)h.push((y+256).toString(16).slice(1));var v=new Uint8Array(16);function g(){if(!p&&!(p="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return p(v)}var w={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function b(e,t,n){if(w.randomUUID&&!t&&!e)return w.randomUUID();var r=(e=e||{}).random||(e.rng||g)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,function(e,t=0){return(h[e[t+0]]+h[e[t+1]]+h[e[t+2]]+h[e[t+3]]+"-"+h[e[t+4]]+h[e[t+5]]+"-"+h[e[t+6]]+h[e[t+7]]+"-"+h[e[t+8]]+h[e[t+9]]+"-"+h[e[t+10]]+h[e[t+11]]+h[e[t+12]]+h[e[t+13]]+h[e[t+14]]+h[e[t+15]]).toLowerCase()}(r)}const m={},E=new u,O=new class extends i{constructor(){super(),this._dispatcher=new d}addListener(e,t,n){return this._dispatcher.addEventListener(e,t,n),this}on(e,t,n){return this.addListener(e,t,n)}once(e,t,n){return this.addListener(e,t,{once:!0,scope:n}),this}removeListener(e,t){return this._dispatcher.removeEventListener(e,t),this}off(e,t){return this.removeListener(e,t)}removeAllListeners(){return this._dispatcher.removeAllEventListeners(),this}hasListener(e){return this._dispatcher.hasEventListener(e)}getListeners(e){return this._dispatcher.getEventListeners(e)}get numberOfEvents(){return this._dispatcher.numberOfEvents}numberOfListeners(e){return this._dispatcher.numberOfListeners(e)}emit(e,...t){return this._dispatcher.dispatch(e,...t),this}emitEvent(e,t){return this._dispatcher.dispatchEvent(e,t||this),this}onDestroy(){this._dispatcher.destroy()}};function L(){return window.jsbridgeInterface?"function"==typeof window.jsbridgeInterface.onBridgeMessage||(console.warn("the window.jsbridgeInterface.onBridgeMessage is not function.",window.jsbridgeInterface),!1):(console.warn("not found the window.jsbridgeInterface object."),!1)}function _(e,n){if(t.defined("message",e),t.typeOf.string("type",e.type),!L())return!1;e.id||(e.id=b()),e.body||(e.body={}),"function"==typeof n&&(m[e.id]=n);const r=JSON.stringify(e);return console.log("postMessageToApp:",r),window.jsbridgeInterface.onBridgeMessage(r),e.id}window.onBridgeMessage=function(e){console.log("onReceiveMessageFromApp:",e);const t=JSON.parse(e);if("messageCallback"===t.type||"methodCallback"===t.type){const e=m[t.id];"function"==typeof e&&t.body&&e(t.body),t.persistCallback||delete m[t.id]}else E.raiseEvent(t),O.emit(t.type,t.body)},e.callMethod=function(e,n={},r){return t.typeOf.string("method",e),_({type:"callMethod",body:{method:e,params:n}},r)},e.checkValid=L,e.onEvent=O,e.onMessage=E,e.postMessage=_}));
