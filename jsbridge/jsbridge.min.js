!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).jsbridge={})}(this,(function(e){"use strict";for(var t,r=[],n=0;n<256;++n)r.push((n+256).toString(16).slice(1));var o=new Uint8Array(16);function s(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(o)}var i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function a(e,t,n){if(i.randomUUID&&!t&&!e)return i.randomUUID();var o=(e=e||{}).random||(e.rng||s)();return o[6]=15&o[6]|64,o[8]=63&o[8]|128,function(e,t=0){return(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase()}(o)}const f={};function c(e,t,r){return"Expected "+r+" to be typeof "+t+", actual typeof was "+e}function l(e,t){e instanceof HTMLElement!=!1?function(e){if(e.parentNode&&e.parentNode.removeChild(e),e instanceof HTMLVideoElement){if(e.hlsPlayer&&(e.hlsPlayer.destroy(),delete e.hlsPlayer),e.flvPlayer){try{e.flvPlayer.unload(),e.flvPlayer.detachMediaElement()}catch(e){console.error(e)}e.flvPlayer.destroy(),delete e.flvPlayer}try{e.pause(),e.loop=!1,e.removeAttribute("src"),e.load()}catch(e){console.error(e)}}else e instanceof HTMLImageElement?e.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=":e instanceof HTMLCanvasElement&&(e.apngPlayer&&(e.apngPlayer.stop(),delete e.apngPlayer),e.gifPlayer&&(e.gifPlayer.stop(),delete e.gifPlayer),e.width=e.height=0)}(e):console.warn("The element must be instanceof HTMLElement.")}function u(){return!0}function d(e,t){if(!function(e){return void 0!==e.isDestroyed&&("function"==typeof e.isDestroyed?e.isDestroyed():e.isDestroyed)}(e)&&!e.isDestroying){(t=Object.assign({deleteProperty:!0,ignoreProperties:[],overwriteFunction:!0,releaseArray:!0,destroyHTMLElement:!0},t)).ignoreProperties.push("isDestroying","isDestroyed","destroy","undeletable"),e.isDestroying=!0;for(const n in e)if(!t.ignoreProperties||-1===t.ignoreProperties.indexOf(n)){try{const o=e[n];if(o){if(o.isCached||o.isProtected)continue;if("function"==typeof o&&!0===t.overwriteFunction?e[n]=r:Array.isArray(o)&&!0===t.releaseArray?o.length=0:o instanceof HTMLElement&&!0===t.destroyHTMLElement?l(e[n]):"object"==typeof o&&!0===t.deep&&("function"==typeof o.destroy?o.destroy():d(o,deep)),o.undeletable)continue}}catch(e){console.warn(e)}!0===t.deleteProperty&&delete e[n]}return e.isDestroyed=u,delete e.isDestroying,e}function r(){console.warn("The object isDestroyed, call function is invalid.",e)}console.warn("The object isDestroyed or isDestroying, repeated call destroyObject function are not required.",e)}f.typeOf={},f.defined=function(e,t){if(null==t)throw new Error(function(e){return e+" is required, actual value was undefined."}(e))},f.valid=function(e,t){if(null==(r=t)||"number"==typeof r&&isNaN(r))throw new Error(function(e){return e+" is required, actual value was invalid."}(e));var r},f.typeOf.func=function(e,t){if("function"!=typeof t)throw new Error(c(typeof t,"function",e))},f.typeOf.string=function(e,t){if("string"!=typeof t)throw new Error(c(typeof t,"string",e))},f.typeOf.number=function(e,t){if("number"!=typeof t)throw new Error(c(typeof t,"number",e))},f.typeOf.number.lessThan=function(e,t,r){if(f.typeOf.number(e,t),t>=r)throw new Error("Expected "+e+" to be less than "+r+", actual value was "+t)},f.typeOf.number.lessThanOrEquals=function(e,t,r){if(f.typeOf.number(e,t),t>r)throw new Error("Expected "+e+" to be less than or equal to "+r+", actual value was "+t)},f.typeOf.number.greaterThan=function(e,t,r){if(f.typeOf.number(e,t),t<=r)throw new Error("Expected "+e+" to be greater than "+r+", actual value was "+t)},f.typeOf.number.greaterThanOrEquals=function(e,t,r){if(f.typeOf.number(e,t),t<r)throw new Error("Expected "+e+" to be greater than or equal to"+r+", actual value was "+t)},f.typeOf.number.equals=function(e,t,r,n){if(f.typeOf.number(e,r),f.typeOf.number(t,n),r!==n)throw new Error(e+" must be equal to "+t+", the actual values are "+r+" and "+n)},f.typeOf.object=function(e,t){if("object"!=typeof t)throw new Error(c(typeof t,"object",e))},f.typeOf.bool=function(e,t){if("boolean"!=typeof t)throw new Error(c(typeof t,"boolean",e))},f.typeOf.array=function(e,t){if(!1===Array.isArray(t))throw new Error(c(typeof t,"array",e))},f.typeOf.integer=function(e,t){if(!1===Number.isSafeInteger(t))throw new Error(c(typeof t,"integer",e))},f.typeOf.integer.lessThan=function(e,t,r){if(f.typeOf.integer(e,t),t>=r)throw new Error("Expected "+e+" to be less than "+r+", actual value was "+t)},f.typeOf.integer.lessThanOrEquals=function(e,t,r){if(f.typeOf.integer(e,t),t>r)throw new Error("Expected "+e+" to be less than or equal to "+r+", actual value was "+t)},f.typeOf.integer.greaterThan=function(e,t,r){if(f.typeOf.integer(e,t),t<=r)throw new Error("Expected "+e+" to be greater than "+r+", actual value was "+t)},f.typeOf.integer.greaterThanOrEquals=function(e,t,r){if(f.typeOf.integer(e,t),t<r)throw new Error("Expected "+e+" to be greater than or equal to"+r+", actual value was "+t)},f.typeOf.integer.equals=function(e,t,r,n){if(f.typeOf.integer(e,r),f.typeOf.integer(t,n),r!==n)throw new Error(e+" must be equal to "+t+", the actual values are "+r+" and "+n)},f.instanceOf=function(e,t,r){if(t instanceof r==!1)throw new Error(c(!1,r.name,e))},f.equals=function(e,t,r){if(f.isValid(t),f.isValid(r),t!==r)throw new Error("Expected "+e+" to be equal "+r+", actual value was "+t)};class p{isDestroyed(){return!1}onDestroy(...e){}destroy(...e){return this.isDestroyed()?console.warn("This object was destroyed.",this):this.isDestroying?console.warn("This object is destroying.",this):(this.onDestroy(...e),d(this)),this}}const y={},h=new class extends p{constructor(){super(),this._listenersMap=new Map}get numberOfListeners(){return this._listenersMap.size}get listeners(){const e=[],t=this._listenersMap.values();for(const r of t)e.push(r.callback);return e}hasEventListener(e){return this._listenersMap.has(e)}addEventListener(e,t={}){f.typeOf.func("callback",e);let r=this._listenersMap.get(e);return r?r.options=t:(r={callback:e,options:t,removeFunc:()=>{this.removeEventListener(e)}},this._listenersMap.set(e,r)),r.removeFunc}removeEventListener(e){return f.typeOf.func("callback",e),this._listenersMap.delete(e)}on(e,t){return this.addEventListener(e,t)}off(e){return this.removeEventListener(e)}once(e,t){return this.addEventListener(e,{once:!0,scope:t})}clear(){return this._listenersMap.clear(),this}raiseEvent(...e){const t=this._listenersMap.values();for(const e of t){const t=e.options,r=e.callback;r.apply(t.scope,arguments),t.once&&this._listenersMap.delete(r)}return this}onDestroy(){this.clear()}};function w(){return window.jsbridgeInterface?"function"==typeof window.jsbridgeInterface.onBridgeMessage||(console.warn("the window.jsbridgeInterface.onBridgeMessage is not function.",window.jsbridgeInterface),!1):(console.warn("not found the window.jsbridgeInterface object."),!1)}function g(e,t){if(f.defined("message",e),f.typeOf.string("type",e.type),!w())return!1;e.id||(e.id=a()),e.body||(e.body={}),"function"==typeof t&&(y[e.id]=t);const r=JSON.stringify(e);return console.log("postMessageToApp:",r),window.jsbridgeInterface.onBridgeMessage(r),e.id}window.onBridgeMessage=function(e){console.log("onReceiveMessageFromApp:",e);const t=JSON.parse(e);if("messageCallback"===t.type||"methodCallback"===t.type){const e=y[t.id];"function"==typeof e&&t.body&&e(t.body),t.persistCallback||delete y[t.id]}else h.raiseEvent(t)},e.callMethod=function(e,t={},r){return f.typeOf.string("method",e),g({type:"callMethod",body:{method:e,params:t}},r)},e.checkValid=w,e.onMessage=h,e.postMessage=g}));
