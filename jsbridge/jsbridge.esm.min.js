for(var e,t=[],r=0;r<256;++r)t.push((r+256).toString(16).slice(1));var n=new Uint8Array(16);function o(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(n)}var s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function i(e,r,n){if(s.randomUUID&&!r&&!e)return s.randomUUID();var i=(e=e||{}).random||(e.rng||o)();return i[6]=15&i[6]|64,i[8]=63&i[8]|128,function(e,r=0){return(t[e[r+0]]+t[e[r+1]]+t[e[r+2]]+t[e[r+3]]+"-"+t[e[r+4]]+t[e[r+5]]+"-"+t[e[r+6]]+t[e[r+7]]+"-"+t[e[r+8]]+t[e[r+9]]+"-"+t[e[r+10]]+t[e[r+11]]+t[e[r+12]]+t[e[r+13]]+t[e[r+14]]+t[e[r+15]]).toLowerCase()}(i)}const a={};function f(e,t,r){return"Expected "+r+" to be typeof "+t+", actual typeof was "+e}function c(e,t){e instanceof HTMLElement!=!1?function(e){if(e.parentNode&&e.parentNode.removeChild(e),e instanceof HTMLVideoElement){if(e.hlsPlayer&&(e.hlsPlayer.destroy(),delete e.hlsPlayer),e.flvPlayer){try{e.flvPlayer.unload(),e.flvPlayer.detachMediaElement()}catch(e){console.error(e)}e.flvPlayer.destroy(),delete e.flvPlayer}try{e.pause(),e.loop=!1,e.removeAttribute("src"),e.load()}catch(e){console.error(e)}}else e instanceof HTMLImageElement?e.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=":e instanceof HTMLCanvasElement&&(e.apngPlayer&&(e.apngPlayer.stop(),delete e.apngPlayer),e.gifPlayer&&(e.gifPlayer.stop(),delete e.gifPlayer),e.width=e.height=0)}(e):console.warn("The element must be instanceof HTMLElement.")}function l(){return!0}function u(e,t){if(!function(e){return void 0!==e.isDestroyed&&("function"==typeof e.isDestroyed?e.isDestroyed():e.isDestroyed)}(e)&&!e.isDestroying){(t=Object.assign({deleteProperty:!0,ignoreProperties:[],overwriteFunction:!0,releaseArray:!0,destroyHTMLElement:!0},t)).ignoreProperties.push("isDestroying","isDestroyed","destroy","undeletable"),e.isDestroying=!0;for(const n in e)if(!t.ignoreProperties||-1===t.ignoreProperties.indexOf(n)){try{const o=e[n];if(o){if(o.isCached||o.isProtected)continue;if("function"==typeof o&&!0===t.overwriteFunction?e[n]=r:Array.isArray(o)&&!0===t.releaseArray?o.length=0:o instanceof HTMLElement&&!0===t.destroyHTMLElement?c(e[n]):"object"==typeof o&&!0===t.deep&&("function"==typeof o.destroy?o.destroy():u(o,deep)),o.undeletable)continue}}catch(e){console.warn(e)}!0===t.deleteProperty&&delete e[n]}return e.isDestroyed=l,delete e.isDestroying,e}function r(){console.warn("The object isDestroyed, call function is invalid.",e)}console.warn("The object isDestroyed or isDestroying, repeated call destroyObject function are not required.",e)}a.typeOf={},a.defined=function(e,t){if(null==t)throw new Error(function(e){return e+" is required, actual value was undefined."}(e))},a.valid=function(e,t){if(null==(r=t)||"number"==typeof r&&isNaN(r))throw new Error(function(e){return e+" is required, actual value was invalid."}(e));var r},a.typeOf.func=function(e,t){if("function"!=typeof t)throw new Error(f(typeof t,"function",e))},a.typeOf.string=function(e,t){if("string"!=typeof t)throw new Error(f(typeof t,"string",e))},a.typeOf.number=function(e,t){if("number"!=typeof t)throw new Error(f(typeof t,"number",e))},a.typeOf.number.lessThan=function(e,t,r){if(a.typeOf.number(e,t),t>=r)throw new Error("Expected "+e+" to be less than "+r+", actual value was "+t)},a.typeOf.number.lessThanOrEquals=function(e,t,r){if(a.typeOf.number(e,t),t>r)throw new Error("Expected "+e+" to be less than or equal to "+r+", actual value was "+t)},a.typeOf.number.greaterThan=function(e,t,r){if(a.typeOf.number(e,t),t<=r)throw new Error("Expected "+e+" to be greater than "+r+", actual value was "+t)},a.typeOf.number.greaterThanOrEquals=function(e,t,r){if(a.typeOf.number(e,t),t<r)throw new Error("Expected "+e+" to be greater than or equal to"+r+", actual value was "+t)},a.typeOf.number.equals=function(e,t,r,n){if(a.typeOf.number(e,r),a.typeOf.number(t,n),r!==n)throw new Error(e+" must be equal to "+t+", the actual values are "+r+" and "+n)},a.typeOf.object=function(e,t){if("object"!=typeof t)throw new Error(f(typeof t,"object",e))},a.typeOf.bool=function(e,t){if("boolean"!=typeof t)throw new Error(f(typeof t,"boolean",e))},a.typeOf.array=function(e,t){if(!1===Array.isArray(t))throw new Error(f(typeof t,"array",e))},a.typeOf.integer=function(e,t){if(!1===Number.isSafeInteger(t))throw new Error(f(typeof t,"integer",e))},a.typeOf.integer.lessThan=function(e,t,r){if(a.typeOf.integer(e,t),t>=r)throw new Error("Expected "+e+" to be less than "+r+", actual value was "+t)},a.typeOf.integer.lessThanOrEquals=function(e,t,r){if(a.typeOf.integer(e,t),t>r)throw new Error("Expected "+e+" to be less than or equal to "+r+", actual value was "+t)},a.typeOf.integer.greaterThan=function(e,t,r){if(a.typeOf.integer(e,t),t<=r)throw new Error("Expected "+e+" to be greater than "+r+", actual value was "+t)},a.typeOf.integer.greaterThanOrEquals=function(e,t,r){if(a.typeOf.integer(e,t),t<r)throw new Error("Expected "+e+" to be greater than or equal to"+r+", actual value was "+t)},a.typeOf.integer.equals=function(e,t,r,n){if(a.typeOf.integer(e,r),a.typeOf.integer(t,n),r!==n)throw new Error(e+" must be equal to "+t+", the actual values are "+r+" and "+n)},a.instanceOf=function(e,t,r){if(t instanceof r==!1)throw new Error(f(!1,r.name,e))},a.equals=function(e,t,r){if(a.isValid(t),a.isValid(r),t!==r)throw new Error("Expected "+e+" to be equal "+r+", actual value was "+t)};class d{isDestroyed(){return!1}onDestroy(...e){}destroy(...e){return this.isDestroyed()?console.warn("This object was destroyed.",this):this.isDestroying?console.warn("This object is destroying.",this):(this.onDestroy(...e),u(this)),this}}const y={},p=new class extends d{constructor(){super(),this._listenersMap=new Map}get numberOfListeners(){return this._listenersMap.size}get listeners(){const e=[],t=this._listenersMap.values();for(const r of t)e.push(r.callback);return e}hasEventListener(e){return this._listenersMap.has(e)}addEventListener(e,t={}){a.typeOf.func("callback",e);let r=this._listenersMap.get(e);return r?r.options=t:(r={callback:e,options:t,removeFunc:()=>{this.removeEventListener(e)}},this._listenersMap.set(e,r)),r.removeFunc}removeEventListener(e){return a.typeOf.func("callback",e),this._listenersMap.delete(e)}on(e,t){return this.addEventListener(e,t)}off(e){return this.removeEventListener(e)}once(e,t){return this.addEventListener(e,{once:!0,scope:t})}clear(){return this._listenersMap.clear(),this}raiseEvent(...e){const t=this._listenersMap.values();for(const e of t){const t=e.options,r=e.callback;r.apply(t.scope,arguments),t.once&&this._listenersMap.delete(r)}return this}onDestroy(){this.clear()}};function h(e,t){if(a.defined("message",e),a.typeOf.string("type",e.type),!window.jsbridgeInterface)return console.warn("not found window.jsbridgeInterface object"),!1;if("function"!=typeof window.jsbridgeInterface.onBridgeMessage)return console.warn("window.jsbridgeInterface.onBridgeMessage is not function",window.jsbridgeInterface.onBridgeMessage),!1;e.id||(e.id=i()),e.body||(e.body={}),"function"==typeof t&&(y[e.id]=t);const r=JSON.stringify(e);return console.log("postMessageToApp:",r),window.jsbridgeInterface.onBridgeMessage(r),e.id}function w(e,t={},r){return a.typeOf.string("method",e),h({type:"callMethod",body:{method:e,params:t}},r)}window.onBridgeMessage=function(e){console.log("onReceiveMessageFromApp:",e);const t=JSON.parse(e);if("messageCallback"===t.type||"methodCallback"===t.type){const e=y[t.id];"function"==typeof e&&t.body&&e(t.body),t.persistCallback||delete y[t.id]}else p.raiseEvent(t)};export{w as callMethod,p as onMessage,h as postMessage};
